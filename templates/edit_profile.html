{% extends "base.html" %} {% block title %}Edit Profile - ChirpX{% endblock %}
{% block content %}
<div class="max-w-3xl mx-auto">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
      Edit Profile
    </h1>
    <p class="text-gray-600 dark:text-gray-400">
      Update your profile information and appearance
    </p>
  </div>

  <!-- Form Container -->
  <div
    class="bg-white dark:bg-gray-800 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 p-8"
  >
    <form method="POST" enctype="multipart/form-data" class="space-y-6">
      <!-- Profile Picture Section -->
      <div
        class="flex flex-col items-center pb-6 border-b border-gray-200 dark:border-gray-700"
      >
        <label
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-4 text-center"
          >Profile Picture</label
        >

        <!-- Current Profile Picture Preview -->
        <div class="mb-4">
          {% if user['profile_picture'] %}
          <img
            id="profile-preview"
            src="{{ url_for('static', filename=user['profile_picture']) }}"
            alt="Profile"
            class="w-32 h-32 rounded-full object-cover border-4 border-primary-500"
          />
          {% else %}
          <div
            id="profile-preview"
            class="w-32 h-32 rounded-full bg-gradient-to-br from-primary-500 to-purple-500 flex items-center justify-center text-white font-bold text-5xl border-4 border-primary-500"
          >
            {{ user['username'][0].upper() }}
          </div>
          {% endif %}
        </div>

        <!-- Upload Button -->
        <div class="w-full max-w-md">
          <label
            for="profile-pic-input"
            class="flex flex-col items-center px-4 py-6 bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors"
          >
            <i
              class="fas fa-cloud-upload-alt text-3xl mb-2 text-primary-600 dark:text-primary-400"
            ></i>
            <span class="text-sm font-medium"
              >Click to upload or drag and drop</span
            >
            <span class="text-xs text-gray-500 dark:text-gray-400 mt-1"
              >JPG, PNG, GIF (Max 16MB)</span
            >
            <input
              id="profile-pic-input"
              type="file"
              name="profile_picture"
              accept="image/*"
              class="hidden"
            />
          </label>
          <p
            id="file-name"
            class="mt-2 text-sm text-center text-gray-600 dark:text-gray-400"
          >
            No file chosen
          </p>
        </div>
      </div>

      <!-- Username (Read-only) -->
      <div>
        <label
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >
          <i class="fas fa-user mr-2 text-gray-400"></i>Username
        </label>
        <input
          type="text"
          value="@{{ user['username'] }}"
          disabled
          class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed"
        />
        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
          Username cannot be changed
        </p>
      </div>

      <!-- Full Name -->
      <div>
        <label
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >
          <i class="fas fa-id-card mr-2 text-gray-400"></i>Full Name
        </label>
        <input
          class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
          type="text"
          name="full_name"
          value="{{ user['full_name'] or '' }}"
          placeholder="Your full name"
          maxlength="100"
        />
      </div>

      <!-- Bio -->
      <div>
        <label
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >
          <i class="fas fa-pen mr-2 text-gray-400"></i>Bio
        </label>
        <textarea
          class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none"
          name="bio"
          placeholder="Tell us about yourself..."
          rows="4"
          maxlength="160"
          id="bio-input"
        >
{{ user['bio'] or '' }}</textarea
        >
        <p class="mt-1 text-xs text-right text-gray-500 dark:text-gray-400">
          <span id="bio-counter">{{ (user['bio'] or '')|length }}</span>/160
          characters
        </p>
      </div>

      <!-- Location -->
      <div>
        <label
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >
          <i class="fas fa-map-marker-alt mr-2 text-gray-400"></i>Location
        </label>
        <div class="relative">
          <div
            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
          >
            <i class="fas fa-map-marker-alt text-gray-400"></i>
          </div>
          <input
            class="w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
            type="text"
            name="location"
            value="{{ user['location'] or '' }}"
            placeholder="Where are you?"
            maxlength="50"
          />
        </div>
      </div>

      <!-- Website -->
      <div>
        <label
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
        >
          <i class="fas fa-link mr-2 text-gray-400"></i>Website
        </label>
        <div class="relative">
          <div
            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
          >
            <i class="fas fa-link text-gray-400"></i>
          </div>
          <input
            class="w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
            type="url"
            name="website"
            value="{{ user['website'] or '' }}"
            placeholder="https://example.com"
            maxlength="100"
          />
        </div>
      </div>

      <!-- Action Buttons -->
      <div
        class="flex gap-4 pt-6 border-t border-gray-200 dark:border-gray-700"
      >
        <button
          type="submit"
          class="flex-1 px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium shadow-sm transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"
        >
          <i class="fas fa-save mr-2"></i>Save Changes
        </button>
        <a
          href="{{ url_for('profile', username=session.username) }}"
          class="px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-lg font-medium transition-colors text-center"
        >
          Cancel
        </a>
      </div>
    </form>
  </div>
</div>

{% endblock %} {% block scripts %}
<script>
  // File input handler with preview
  const fileInput = document.getElementById("profile-pic-input");
  const fileName = document.getElementById("file-name");
  const profilePreview = document.getElementById("profile-preview");

  if (fileInput) {
    fileInput.addEventListener("change", function () {
      if (this.files && this.files.length > 0) {
        const file = this.files[0];
        fileName.textContent = file.name;
        fileName.classList.add(
          "text-primary-600",
          "dark:text-primary-400",
          "font-medium"
        );

        // Preview image
        const reader = new FileReader();
        reader.onload = function (e) {
          if (profilePreview.tagName === "IMG") {
            profilePreview.src = e.target.result;
          } else {
            // Replace div with img for preview
            const img = document.createElement("img");
            img.id = "profile-preview";
            img.src = e.target.result;
            img.className =
              "w-32 h-32 rounded-full object-cover border-4 border-primary-500";
            profilePreview.parentNode.replaceChild(img, profilePreview);
          }
        };
        reader.readAsDataURL(file);
      } else {
        fileName.textContent = "No file chosen";
        fileName.classList.remove(
          "text-primary-600",
          "dark:text-primary-400",
          "font-medium"
        );
      }
    });
  }

  // Bio character counter
  const bioInput = document.getElementById("bio-input");
  const bioCounter = document.getElementById("bio-counter");

  if (bioInput && bioCounter) {
    bioInput.addEventListener("input", function () {
      const length = this.value.length;
      bioCounter.textContent = length;

      if (length > 140) {
        bioCounter.parentElement.classList.add(
          "text-yellow-600",
          "dark:text-yellow-400"
        );
        bioCounter.parentElement.classList.remove(
          "text-gray-500",
          "dark:text-gray-400"
        );
      } else {
        bioCounter.parentElement.classList.remove(
          "text-yellow-600",
          "dark:text-yellow-400"
        );
        bioCounter.parentElement.classList.add(
          "text-gray-500",
          "dark:text-gray-400"
        );
      }
    });
  }
</script>
{% endblock %}
