<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}ChirpX{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#f0f9ff",
                100: "#e0f2fe",
                200: "#bae6fd",
                300: "#7dd3fc",
                400: "#38bdf8",
                500: "#0ea5e9",
                600: "#0284c7",
                700: "#0369a1",
                800: "#075985",
                900: "#0c4a6e",
              },
            },
          },
        },
      };
    </script>
    <style>
      [x-cloak] {
        display: none !important;
      }

      /* Logo Wave Animation */
      @keyframes wave {
        0%,
        100% {
          transform: scaleY(1);
        }
        50% {
          transform: scaleY(1.4);
        }
      }

      .logo-wave path:nth-child(1) {
        animation: wave 1.5s ease-in-out infinite;
        animation-delay: 0s;
        transform-origin: center;
      }

      .logo-wave path:nth-child(2) {
        animation: wave 1.5s ease-in-out infinite;
        animation-delay: 0.1s;
        transform-origin: center;
      }

      .logo-wave path:nth-child(3) {
        animation: wave 1.5s ease-in-out infinite;
        animation-delay: 0.2s;
        transform-origin: center;
      }

      .logo-wave path:nth-child(4) {
        animation: wave 1.5s ease-in-out infinite;
        animation-delay: 0.3s;
        transform-origin: center;
      }

      .logo-wave path:nth-child(5) {
        animation: wave 1.5s ease-in-out infinite;
        animation-delay: 0.4s;
        transform-origin: center;
      }
    </style>
  </head>
  <body
    class="h-full bg-gray-50 dark:bg-gray-900 transition-colors duration-200"
  >
    <nav
      class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-50 shadow-sm"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
          <div class="flex items-center space-x-8">
            <a
              href="{{ url_for('timeline' if session.user_id else 'index') }}"
              class="flex items-center"
            >
              <svg
                class="w-8 h-8 text-primary-600 dark:text-primary-400 logo-wave"
                viewBox="0 0 24 24"
              >
                <path
                  d="M12 3v18"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  fill="none"
                ></path>
                <path
                  d="M8 6v12"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  fill="none"
                ></path>
                <path
                  d="M16 6v12"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  fill="none"
                ></path>
                <path
                  d="M4 9v6"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  fill="none"
                ></path>
                <path
                  d="M20 9v6"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  fill="none"
                ></path>
              </svg>
              <span
                class="ml-2 text-2xl font-bold text-gray-900 dark:text-white"
                >ChirpX</span
              >
            </a>
            {% if session.user_id %}
            <div class="hidden md:flex space-x-1">
              <a
                href="{{ url_for('timeline') }}"
                class="px-3 py-2 rounded-lg text-sm font-medium {% if request.endpoint == 'timeline' %}bg-primary-50 dark:bg-primary-900 text-primary-600 dark:text-primary-400{% else %}text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700{% endif %}"
              >
                <i class="fas fa-home mr-2"></i>Home
              </a>
              <a
                href="{{ url_for('explore') }}"
                class="px-3 py-2 rounded-lg text-sm font-medium {% if request.endpoint == 'explore' %}bg-primary-50 dark:bg-primary-900 text-primary-600 dark:text-primary-400{% else %}text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700{% endif %}"
              >
                <i class="fas fa-compass mr-2"></i>Explore
              </a>
              <a
                href="{{ url_for('bookmarks') }}"
                class="px-3 py-2 rounded-lg text-sm font-medium {% if request.endpoint == 'bookmarks' %}bg-primary-50 dark:bg-primary-900 text-primary-600 dark:text-primary-400{% else %}text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700{% endif %}"
              >
                <i class="fas fa-bookmark mr-2"></i>Bookmarks
              </a>
              <a
                href="{{ url_for('messages') }}"
                class="px-3 py-2 rounded-lg text-sm font-medium {% if request.endpoint in ['messages', 'conversation'] %}bg-primary-50 dark:bg-primary-900 text-primary-600 dark:text-primary-400{% else %}text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700{% endif %}"
              >
                <i class="fas fa-envelope mr-2"></i>Messages
              </a>
            </div>
            {% endif %}
          </div>
          <div class="flex items-center space-x-4">
            {% if session.user_id %}
            <form
              method="GET"
              action="{{ url_for('search') }}"
              class="hidden sm:block"
            >
              <div class="relative">
                <input
                  type="text"
                  name="q"
                  placeholder="Search..."
                  class="w-64 px-4 py-2 pl-10 text-sm border border-gray-300 dark:border-gray-600 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500"
                />
                <i
                  class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"
                ></i>
              </div>
            </form>
            <button
              onclick="toggleDarkMode()"
              class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"
            >
              <i class="fas fa-moon dark:hidden"></i>
              <i class="fas fa-sun hidden dark:inline"></i>
            </button>
            <div class="relative" x-data="{ open: false }">
              <button @click="open = !open" class="flex items-center space-x-2">
                <div
                  class="w-10 h-10 rounded-full bg-gradient-to-br from-primary-500 to-purple-500 flex items-center justify-center text-white font-bold"
                >
                  {{ session.username[0].upper() }}
                </div>
              </button>
              <div
                x-show="open"
                @click.away="open = false"
                x-cloak
                class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg py-2 border border-gray-200 dark:border-gray-700"
              >
                <a
                  href="{{ url_for('profile', username=session.username) }}"
                  class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
                >
                  <i class="fas fa-user mr-2"></i>Profile
                </a>
                <a
                  href="{{ url_for('edit_profile') }}"
                  class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
                >
                  <i class="fas fa-cog mr-2"></i>Settings
                </a>
                <div
                  class="border-t border-gray-200 dark:border-gray-700 my-2"
                ></div>
                <a
                  href="{{ url_for('logout') }}"
                  class="block px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700"
                >
                  <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </a>
              </div>
            </div>
            {% else %}
            <a
              href="{{ url_for('login') }}"
              class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg"
              >Login</a
            >
            <a
              href="{{ url_for('signup') }}"
              class="px-4 py-2 text-sm font-medium bg-primary-600 hover:bg-primary-700 text-white rounded-lg shadow-sm"
              >Sign Up</a
            >
            {% endif %}
          </div>
        </div>
        {% if session.user_id %}
        <div class="md:hidden border-t border-gray-200 dark:border-gray-700">
          <div class="flex justify-around py-2">
            <a
              href="{{ url_for('timeline') }}"
              class="flex flex-col items-center py-2 {% if request.endpoint == 'timeline' %}text-primary-600 dark:text-primary-400{% else %}text-gray-600 dark:text-gray-400{% endif %}"
            >
              <i class="fas fa-home text-xl"></i>
            </a>
            <a
              href="{{ url_for('explore') }}"
              class="flex flex-col items-center py-2 {% if request.endpoint == 'explore' %}text-primary-600 dark:text-primary-400{% else %}text-gray-600 dark:text-gray-400{% endif %}"
            >
              <i class="fas fa-compass text-xl"></i>
            </a>
            <a
              href="{{ url_for('bookmarks') }}"
              class="flex flex-col items-center py-2 {% if request.endpoint == 'bookmarks' %}text-primary-600 dark:text-primary-400{% else %}text-gray-600 dark:text-gray-400{% endif %}"
            >
              <i class="fas fa-bookmark text-xl"></i>
            </a>
            <a
              href="{{ url_for('messages') }}"
              class="flex flex-col items-center py-2 {% if request.endpoint in ['messages', 'conversation'] %}text-primary-600 dark:text-primary-400{% else %}text-gray-600 dark:text-gray-400{% endif %}"
            >
              <i class="fas fa-envelope text-xl"></i>
            </a>
            <a
              href="{{ url_for('search') }}"
              class="flex flex-col items-center py-2 text-gray-600 dark:text-gray-400"
            >
              <i class="fas fa-search text-xl"></i>
            </a>
          </div>
        </div>
        {% endif %}
      </div>
    </nav>
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %}
    <div class="fixed top-20 right-4 z-50 space-y-2">
      {% for category, message in messages %}
      <div
        class="px-4 py-3 rounded-lg shadow-lg max-w-sm animate-slide-in {% if category == 'success' %}bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-100 border border-green-200 dark:border-green-700{% elif category == 'danger' %}bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-100 border border-red-200 dark:border-red-700{% elif category == 'warning' %}bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-100 border border-yellow-200 dark:border-yellow-700{% else %}bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-100 border border-blue-200 dark:border-blue-700{% endif %}"
      >
        <div class="flex items-center space-x-2">
          <i
            class="fas fa-{% if category == 'success' %}check-circle{% elif category == 'danger' %}exclamation-circle{% elif category == 'warning' %}exclamation-triangle{% else %}info-circle{% endif %}"
          ></i>
          <span>{{ message }}</span>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %} {% endwith %}
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      {% block content %}{% endblock %}
    </main>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <style>
      @keyframes slide-in {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      .animate-slide-in {
        animation: slide-in 0.3s ease-out;
      }
    </style>
    <script>
      if (
        localStorage.theme === "dark" ||
        (!("theme" in localStorage) &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        document.documentElement.classList.add("dark");
      }
      function toggleDarkMode() {
        if (document.documentElement.classList.contains("dark")) {
          document.documentElement.classList.remove("dark");
          localStorage.theme = "light";
        } else {
          document.documentElement.classList.add("dark");
          localStorage.theme = "dark";
        }
      }
      setTimeout(() => {
        document.querySelectorAll(".animate-slide-in").forEach((msg) => {
          msg.style.transition =
            "opacity 0.3s ease-out, transform 0.3s ease-out";
          msg.style.opacity = "0";
          msg.style.transform = "translateX(100%)";
          setTimeout(() => msg.remove(), 300);
        });
      }, 5000);
    </script>
    {% block scripts %}{% endblock %}
  </body>
</html>
